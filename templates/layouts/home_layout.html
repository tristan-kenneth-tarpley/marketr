{% extends "layouts/layout.html" %}
{% from "macros/_macros.html" import form_open, breadcrumb, left_nav, form_body, container, product_table, intro_copy %}
{% from "macros/home_macros.html" import tab_bar, section, multi_val_iterator, product_val_iterator %}
{% from "macros/dashboard_macros.html" import todo, messages, goals, score %}
{% from "macros/_admin_macros.html" import admin_sidebar, admin_breadcrumb %}

{% block title %}
<title>Market(r) - Home</title>
{% endblock %}

{% block css %}
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
{% endblock %}

{% block content %}

<div class="main-panel">
	{% if not page.admin %}
		{% with plan="active" %}
			{% include "/core/navbar/sidebar.html" %}
		{% endwith %}
		{% include "/core/navbar/topbar.html" %}
	{% else %}
		{{ admin_sidebar('test', owner, admin, manager) }}
		{% include "/topbar/topbar-admin.html" %}
	{% endif %}
	<style type="text/css">
		.card {
			padding: 3%;
			/*border-top: 6px solid #62cde0;*/
		}
	</style>

	<div class="panel-header panel-header-sm">
	</div>
	<div class="content">
		<div class="append_to">
			<div class="container-fluid">
				<div class="root-card">
					<div id="loading">
						<div class="load-circle"><span class="one"></span></div>
					</div><br><br>
					<div id="content-ready" style="visibility:hidden;">
						{% if page.admin %}
							{{ admin_breadcrumb(page, view="customer profile", profile_view=True) }}

							<h5>{{ page.data['core']['core'][0]['company_name'] }}</h5>
							<p class="small_txt">ID: {{ page.data['core']['core'][0]['id'] }}</p>
						{% endif %}
						{{ tab_bar(page) }}
						<br>
						<div class="tab-content">
							<div class="render_tactics tab-pane active" id="campaigns" role="tabpanel" aria-labelledby="campaigns-tab">
								{% with page=page %}
									{% include "core/campaigns.html" %}
								{% endwith %}
							</div>
							<div class="tab-pane" id="profile" role="tabpanel" aria-labelledby="profile-tab">
								{% with page=page %}
									{% include "core/profile.html" %}
								{% endwith %}
							</div>
							<div class="tab-pane" id="messages" role="tabpanel" aria-labelledby="messages-tab">
								{% with page=page, chat=chat %}
									{% include "core/messages.html" %}
								{% endwith %}
							</div>
							<div class="tab-pane" id="competitors" role="tabpanel" aria-labelledby="competitors-tab">
								<div class="competitor_loading" id="loading">
									<div class="load-circle"><span class="one"></span></div>
								</div>
								<div id="mount_competitors"></div>
							</div>
						</div>

					</div>
				</div>

			</div>
		</div>
	</div>
</div>

{% endblock %}

{% block js %}
<script>
    (function(t,a,l,k,j,s){
        s=a.createElement('script');s.async=1;s.src="https://cdn.talkjs.com/talk.js";a.head.appendChild(s)
        ;k=t.Promise;t.Talk={v:2,ready:{then:function(f){if(k)return new k(function(r,e){l.push([f,r,e])});l
        .push([f])},catch:function(){return k&&new k()},c:l}};})(window,document,[]);
	</script>
	<script>
		Talk.ready.then(function(){
			var me = new Talk.User({
				name: "Tristan",
				id: "{{chat.user_id}}",
				email: "{{chat.email}}",
				role: "{{chat.type}}"
			});
			window.talkSession = new Talk.Session({
				appId: "S9ifmqxv",
				me: me,
				signature: "{{chat.hash}}"
			});

			var operator = new Talk.User({
				id: "admin-6",
				role: 'Admin',
				name: "Tristan Tarpley",
				email: "info@marketr.life",
				photoUrl: "https://marketr.life/static/branding/img/tristan.jpg",
				welcomeMessage: "Welcome to Market(r)! Do you have any particular place in which you'd like to start your marketing journey with us?"
			}); 
			var conversation = window.talkSession.getOrCreateConversation("marketr-{{chat.user_id}}");
			conversation.setParticipant(me);
			conversation.setParticipant(operator);
			var chatbox = window.talkSession.createChatbox(conversation);
			chatbox.mount(document.getElementById("talkjs-container"));
		});
	</script>
{% endblock %}
