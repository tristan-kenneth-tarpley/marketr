{% macro render_page(page, data, a_reps=None, form=None) %}

	{% if page == 'personnel' %}
		{{ personnel(data) }}
	{% elif page == 'customers' %}
		{{ customers(data, a_reps=a_reps, form=form) }}
	{% endif %}

{% endmacro %}



<!-- blocks -->
{% macro render_field(field, currency=False, website=False) %}

<div class="form-group">
	{% if currency %}
	<div class="input-group">
	  <div class="input-group-prepend">
	    <span class="input-group-text">$</span>
	  </div>
	{% endif %}
	{% if website %}
	<div class="input-group col-12">
      <div class="input-group-prepend">
        <span class="input-group-text">https://</span>
      </div>
	{% endif %}

		{{ field(**kwargs)|safe }}

	{% if website %}
	</div>
	{% endif %}

	{% if currency %}
	  <div class="input-group-append">
	    <span class="input-group-text">.00</span>
	  </div>
	</div>
	{% endif %}
		{% if field.errors %}
			<ul class="errors text-danger">
			{% for error in field.errors %}
				<li>{{ error }}</li>
			{% endfor %}
			</ul>
		{% endif %}
		</dd>
</div>

{% endmacro %}

{% macro admin_sidebar(stage, owner, admin, manager) %}

<div class="sidebar" data-color="orange">
	<div class="logo">
	  <a href="https://marketr.life" class="simple-text logo-normal">
	    <img src="/static/assets/img/marketrwhite.png">
	  </a>
	</div>
	<div class="sidebar-wrapper">
	  <ul class="nav">
		    <li class="{{ 0 | check_active(stage) }}">
		      <a href="/admin">
		        <i class="now-ui-icons design_app"></i>
		        <p>Home</p>
		      </a>
		    </li>
	  	{% if owner %}
		    <li class="{{ 0 | check_active(stage) }}">
		      <a href="/personnel">
		        <i class="now-ui-icons design_app"></i>
		        <p>Manage personnel</p>
		      </a>
		    </li>
		    <li class="{{ 0 | check_active(stage) }}">
		      <a href="/customers">
		        <i class="now-ui-icons design_app"></i>
		        <p>Customers</p>
		      </a>
		    </li>
		{% endif %}
	  	{% if admin %}
		    <li class="{{ 0 | check_active(stage) }}">
		      <a href="/personnel">
		        <i class="now-ui-icons design_app"></i>
		        <p>Rocks</p>
		      </a>
		    </li>
		{% endif %}
	  </ul>
	</div>
</div>

{% endmacro %}






{# personnel page #}

{% macro personnel(data, error=None) %}

<h6>Personnel</h6>

 <nav aria-label="breadcrumb" role="navigation">
 	<ol class="breadcrumb">
 		<li class="breadcrumb-item">
    		<button type="button" class="btn btn-neutral" data-toggle="modal" data-target="#add_user">
	          Add user
	        </button>
	        {{ form_modal(name='add_user', id='0', header='add user', copy=create_form('add_user', 'add_user')) }}
	    </li>
 	</ol>
 </nav>

<div class="row">
	{% for data in data %}
		{% set first_name = data[0] %}
		{% set last_name = data[1] %}
		{% set email = data[2] %}
		{% set permissions = data[3] %}
		{% set id = data[4] %}
		{% set position = data[5] %}
		{% set phone = data[6] %}
		
		<div class="personnel card col-lg-3">

			<div class="modal fade" id="change_password_{{id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h6>Update {{ first_name }} {{ last_name }}</h6>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">
							<form action="/admin/change_password/{{id}}" method="POST">

								<div class="form-group">
									<label>Current password</label>
									<input type="password" name="current_password" class="form-control" placeholder="current password">
								</div>
								<div class="form-group">
									<label>New Password</label>
									<input type="password" name="new_password" class="form-control" placeholder="new password">
								</div>

								<input type="submit" class="btn btn-primary">

							</form>
						</div>
					</div>
				</div>
			</div>



	        <div class="modal fade" id="remove_user_{{id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
			  <div class="modal-dialog" role="document">
			    <div class="modal-content">
			      <div class="modal-header">
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			          <span aria-hidden="true">&times;</span>
			        </button>
			      </div>
			      <div class="modal-body">
			        <p>Are you sure you want to remove this user?</p>
			      </div>
			      <div class="modal-footer">
			        <button type="button" class="btn btn-secondary" data-dismiss="modal">No, cancel</button>
			        <a class="btn btn-primary" href="/admin/remove/{{id}}">Yes, I'm sure</a>
			      </div>
			    </div>
			  </div>
			</div>

	        <div class="modal fade" id="edit_info_{{id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
			  <div class="modal-dialog" role="document">
			    <div class="modal-content">
			      <div class="modal-header">
			        <h6>Update {{ first_name }} {{ last_name }}</h6>
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			          <span aria-hidden="true">&times;</span>
			        </button>
			      </div>
			      <div class="modal-body">
			      	<form action="/admin/update/{{id}}" method="POST">

						<div class="form-group">
							<label>First name</label>
							<input type="text" name="first_name" class="form-control"  value="{{ first_name }}">
						</div>
						<div class="form-group">
							<label>Last name</label>
							<input type="text" name="last_name" class="form-control"  value="{{ last_name }}">
						</div>
						<div class="form-group">
							<label>Email</label>
							<input type="text" name="email" class="form-control"  value="{{ email }}">
						</div>
						<div class="form-group">
							<label>Phone</label>
							<input type="number" name="phone" class="form-control"  value="{{ phone }}">
						</div>
						<div class="form-group">
							<label>Position</label>
							<input type="text" name="position" class="form-control" value="{{ position }}">
						</div>
						{% if permissions != 'owner' %}
						<div class="form-group">
						{% else %}
						<div class="form-group hidden">
						{% endif %}
							<label>Permissions</label>
							<select name="permissions">
								<option>owner</option>
								<option>admin</option>
								<option>manager</option>
							</select>
						</div>

						<input type="submit" class="btn btn-primary">

			      	</form>
			      </div>
			    </div>
			  </div>
			</div>

            <div class="dropdown" style="text-align: right;">
              <button type="button" class="btn btn-round btn-outline dropdown-toggle btn-simple btn-icon no-caret" data-toggle="dropdown">
                <i class="now-ui-icons loader_gear"></i>
              </button>
              <div class="dropdown-menu dropdown-menu-right">
				<button type="button" class="btn btn-neutral" data-toggle="modal" data-target="#change_password_{{id}}">
		          change password
		        </button>

				<button type="button" class="btn btn-neutral" data-toggle="modal" data-target="#edit_info_{{id}}">
		          edit info
		        </button>

		        

				{% if permissions != 'owner' %}

					<button type="button" class="btn btn-neutral text-danger" data-toggle="modal" data-target="#remove_user_{{id}}">
			          <strong>remove user</strong>
			        </button>

				{% endif %}
              </div>
            </div>

			<h5>{{ first_name }} {{ last_name }}</h5>


			<div class="separator"></div>
			<p><strong>{{ position }}</strong></p>
			<p>{{ email }}</p>
			<p>{{ permissions }}</p>
			<p>{{ phone }}</p>


			<div class="personnel_actions_container">


			</div>
 
		</div>

	{% endfor %}
</div>

{% endmacro %}






{# customers page #}


{% macro customers(data, a_reps=None, error=None, form=None) %}

	<table id="display" style="width:100%;" class="table table-striped">
      <thead>
        <tr>
          <th style="cursor:pointer;"></th>
          <th style="cursor:pointer;">Company Name</th>
          <th style="cursor:pointer;">Primary Contact</th>
          <th style="cursor:pointer;">Email</th>
          <th style="cursor:pointer;">Account Mgr.</th>
        </tr>
      </thead>
      <tbody>
		{% for row in data %}
			<tr>
				{% set id = data[row]['customer_id'] %}
				{% set primary_contact = data[row]['name'] %}
				{% set email = data[row]['email'] %}
				{% set company_name = data[row]['company_name'] %}
				{% set account_rep = data[row]['account_rep'] %}
				{% set admin_id = data[row]['admin_id'] %}
				

				<td style="color: white;text-transform: uppercase;font-weight:bold;">
			        <button type="button" class="btn btn-icon btn-round btn-primary" id="account_reps" data-toggle="modal" data-target="#customer_info_{{id}}">
			          <i class="now-ui-icons users_single-02"></i>
			        </button>

					<div class="modal fade" id="customer_info_{{id}}" tabindex="-1" role="dialog" aria-labelledby="customer_info_{{id}}" aria-hidden="true">
						<div class="modal-dialog" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-label="Close">
										<span aria-hidden="true">&times;</span>
									</button>
								</div>
								<div class="modal-body" style="color:var(--body-copy);">
									<h6>{{ company_name }} reps</h6>
									<div class="separator"></div>
									<ul id="current_reps">
									</ul>
									<form action="/customers/{{id}}/add_rep" method="POST">

										<div class="form-group">
											{{ render_field(form.rep_name, id="get_admins") }}
										</div>
										
										{% set route = '/get_admins' %}
										<script type="text/javascript">
											var options = {
											  url: "{{route}}",
											  getValue: "{{ route | remove_first_char }}",
											  list: {	
											    match: {
											      enabled: true
											    }
											  },
											  theme: "square"
											};
											$("#get_admins").easyAutocomplete(options);
										</script>

										<input type="submit" value="add" class="btn btn-primary">

									</form>
								</div>
							</div>
						</div>
					</div>
				</td>
				<td>{{ company_name }}</td>
				<td>{{ primary_contact }}</td>
				<td>{{ email }}</td>
				<td>{{ account_rep }}</td>
			</tr>
		{% endfor %}
        
      </tbody>
    </table>
    <script type="text/javascript" src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js" defer></script>
    <script>

	$(document).ready( function () {
	    $('#display').DataTable({
	      "order": [[ 0, "asc" ]]
	    });

	    $(".dataTables_filter input").addClass("form-control")
	    $(".dataTables_filter input").unwrap()
	    $(".dataTables_filter input").parent().addClass("searcher")
	    $(".dataTables_filter input").attr("placeholder", "Type company name...");
	    $('.searcher').contents().eq(0).remove()
	    $(".searcher").addClass("input-group")
	    $(".searcher").addClass("no-border")
	    $(".searcher").append("<div class='input-group-append'><div class='input-group-text'><i class='now-ui-icons ui-1_zoom-bold'></i></div></div>")

	} );
	</script>

{% endmacro %}


{% macro form_modal(copy=None, header=None, action=None, name=None, id='0') %}

<div class="modal fade" id="{{ name }}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h6 class="modal-title" id="exampleModalLabel">{{ header | upper }}</h6>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        {{ copy }}
      </div>
    </div>
  </div>
</div>

{% endmacro %}

{% macro create_form(form, name, id='0') %}

<form action="/admin/{{name}}/{{id}}" method="POST">

		{% if form == 'change_password' %}	

			<div class="form-group">
				<label>Current password</label>
				<input type="password" name="current_password" class="form-control" placeholder="current password">
			</div>
			<div class="form-group">
				<label>New Password</label>
				<input type="password" name="new_password" class="form-control" placeholder="new password">
			</div>

		{% elif form == 'add_user' %}

			<div class="form-group">
				<label>First name</label>
				<input type="text" name="first_name" class="form-control" placeholder="current password">
			</div>
			<div class="form-group">
				<label>Last name</label>
				<input type="text" name="last_name" class="form-control" placeholder="new password">
			</div>
			<div class="form-group">
				<label>Email</label>
				<input type="text" name="email" class="form-control" placeholder="new password">
			</div>
			<div class="form-group">
				<label>Phone</label>
				<input type="number" name="phone" id="phone{{id}}" class="form-control" placeholder="5555555555">
			</div>

			<script>
			var cleave = new Cleave('#phone{{id}}', {
			    delimiter: '-',
			    blocks: [3, 3],
			    uppercase: true
			});
			</script>

			<div class="form-group">
				<label>Position</label>
				<input type="number" name="position" class="form-control" placeholder="***">
			</div>
			<div class="form-group">
				<label>Permissions</label>
				<select name="permissions">
					<option>owner</option>
					<option>admin</option>
					<option>manager</option>
				</select>
			</div>

		{% endif %}

		<input type="submit" class="btn btn-primary">

</form>

{% endmacro %}










