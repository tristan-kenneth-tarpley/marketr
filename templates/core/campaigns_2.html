
{% from "macros/dashboard_macros.html" import goals, tactics, insights, ads_performance, ad_metrics, test_performance %}
{% from "macros/home_macros.html" import locked %}


{% macro animation() %}
<a class="dl-button" href="">
        <div>
          <div class="label">
            <div class="show default">Do it<br>for me</div>
            <div class="state">
              <div class="counter">
                <ul>
                  <li></li>
                  <li>1</li>
                </ul>
                <ul>
                  <li>0</li><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>0</li>
                </ul>
                <ul>
                  <li>0</li><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>0</li><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>0</li><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>0</li>
                </ul><span>%</span>
              </div><span>Done</span>
            </div>
          </div>
          <div class="progress"></div>
        </div></a>
{% endmacro %}


{% set current_plan = page.data['core']['core'][0]['current_plan'] %}
{% set ab_plan = page.data['core']['core'][0]['ab_binary'] %}
{% set almost_free = page.data['core']['core'][0]['almost_free_binary'] %}
{% set ad_plan = page.data['core']['core'][0]['ad_binary'] %}
{% set ad_premium = page.data['core']['core'][0][''] %}
{% set company_name = page.data['core']['company_name'] %}

<div style="padding-bottom:1%;" class="card">
    <div class="row row_cancel">
        <div class="col-md-2 col-12"></div>
        <div class="col-md-4 col-12">
            <p><strong>Recommended Advertising Budget:</strong></p>
            <div style="padding-top:7%;" class="card center_it negative_card">
                <h5><strong><span class="rec_budget"></span></strong>/month</h5>
            </div>
        </div>
        <div class="col-md-4 col-12">
            <p class="small_txt">I typically <strong>actually</strong> spend this:</p>
            <div class="form-group">
                <input type="number" id="typical" value="$1,500/month" class="form-control">
                <div class="form-control-border"></div>
            </div>
            <p class="small_txt"><em>Changing this will affect the marketing mix spend below</em></p>
        </div>
        <div class="col-md-2 col-12">
            <button id="recalc" class="hidden btn btn-outline btn-outline-primary">Recalculate</button>
        </div>
    </div>
</div>
<div class="row">
    <div class="col">
        <div class="card">
            <p class="center_it">Below is your custom <strong>marketing investment mix </strong> based on a budget of <span class="viewed_budget"></span>.</p>
            <div class="row center_it">
                <div class="col-md-3"></div>
                <div class="col-md-2 col-6">
                    <p class="small_txt">Brand strength</p>
                    {% set options = ['high', 'medium', 'low'] %}
                    <select id="brand_strength" class="considerations_select form-control">
                            {% if page.data['core']['core'][0].get('brand_strength') %}
                                <option>{{ page.data['core']['core'][0].get('brand_strength') }}</option>
                                {% for option in options %}
                                    {% if option != page.data['core']['core'][0].get('brand_strength') %}
                                    <option>{{ option }}</option>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                {% for option in options %}
                                <option>{{option}}</option>
                                {% endfor %}
                            {% endif %}
                    </select>
                </div>
                <div class="col-md-2 col-6">
                    <p class="small_txt">Growth needs</p>
                    <select id="growth_needs" class="considerations_select form-control">
                        {% if page.data['core']['core'][0].get('growth_needs') %}
                            <option>{{ page.data['core']['core'][0].get('growth_needs') }}</option>
                            {% for option in options %}
                                {% if option != page.data['core']['core'][0].get('growth_needs') %}
                                <option>{{ option }}</option>
                                {% endif %}
                            {% endfor %}
                        {% else %}
                            {% for option in options %}
                            <option>{{option}}</option>
                            {% endfor %}
                        {% endif %}
                    </select>
                </div>
                <div class="col-md-2 col-6">
                    <p class="small_txt">Market Competitiveness</p>
                    <select id="competitiveness" class="considerations_select form-control">
                            {% if page.data['core']['core'][0].get('growth_needs') %}
                                <option>{{ page.data['core']['core'][0].get('competitiveness') }}</option>
                                {% for option in options %}
                                    {% if option != page.data['core']['core'][0].get('competitiveness') %}
                                    <option>{{ option }}</option>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                {% for option in options %}
                                <option>{{option}}</option>
                                {% endfor %}
                            {% endif %}
                    </select>
                </div>
                <div class="col-md-3">
                    <button id="recalc_considerations" class="hidden btn btn-outline btn-outline-primary">Recalculate</button>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6 col-sm-12">
                    <canvas width="100%" height="60%" id="allocation_canvas"></canvas>
                </div>
                <div class="col-lg-6 col-sm-12">
                    <br>
                    <button class="view_perc small_txt allocation_toggle btn btn-secondary">% of total<br>monthly budget</button>
                    <button class="view_usd small_txt allocation_toggle allocation_toggle-inactive btn">USD ($)</button>
                    <div id="stage_breakdown" class="inset">
                    </div>
                </div>
            </div>
            {% if not page.data['core']['core'][0].get('current_plan') %}
            <div class="row row_cancel">
                <div class="center_it small_txt col card negative_card">
                    <h5><strong>See how easy it can be?</strong></h5>
                    <p>Based on your marketing spend recommendations, we suggest <span class="rec_budget"></span> spend/month across 3 campaigns.</p>
                    <p>Let Market(r) take this off your plate.</p>
                    <a href="/pricing" class="small_txt btn btn-secondary">Do this for me</a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

        
<div class="row">  
    <div class="col-lg-6 col-sm-12">                   
        {% if current_plan %}
        {{ section(
            link=None,
            title="Insights",
            body=insights(page),
            hash="insights",
            admin=page.admin
        ) }}
        {% else %}
        {{ section(
            link=None,
            title="Insights <i class='fa fa-lock'></i>",
            body=locked(type="insights"),
            hash="insights",
            admin=page.admin
        ) }}
        {% endif %}
    </div>

    <div class="col-lg-6 col-sm-12">
        {% macro tactics_empty() %}
            <div class="tactics_loading" id="loading">
                <div class="load-circle"><span class="one"></span></div>
            </div>
            <div id='tactics_mount'></div>
        {% endmacro %}

        {{ section(
            link=None,
            title="Tactic of the Day",
            body=tactics_empty(),
            hash="tactics",
            admin=page.admin
        ) }}
    </div>
</div> 

{% block js %}
{% set base = page.data['core']['core'][0] %}
<script type="module">
    import AdSpend from '/static/core-js/Spend.js'
    const spendobj = new AdSpend(
        "{{page.data['spend_rec']['spend_rec'][0]['model']}}",
        "{{base.get('stage')}}",
        "{{base.get('revenue')}}",
        "{{base.get('brand_strength') if base.get('brand_strength') else 'medium' }}",
        "{{base.get('growth_needs') if base.get('growth_needs') else 'medium' }}",
        "{{base.get('competitiveness') if base.get('competitiveness') else 'medium' }}",
        "{{base.get('selling_to')}}",
        "{{base.get('biz_model')}}"
    )
    spendobj.get()
</script>

{% endblock %}




<script>

$('.dl-button').on('click', e => {

    let btn = $(e.currentTarget),
        label = btn.find('.label'),
        counter = label.find('.counter');

    if(!btn.hasClass('active') && !btn.hasClass('done')) {

        btn.addClass('active');

        setLabel(label, label.find('.default'), label.find('.state'));

        setTimeout(() => {
            counter.addClass('hide');
            counter.animate({
                width: 0
            }, 400, function() {
                label.width(label.find('.state > span').width());
                counter.removeAttr('style');
            });
            btn.removeClass('active').addClass('done');
        }, getComputedStyle(btn[0]).getPropertyValue('--duration'));

    }

    return false;

});

$('.restart').on('click', e => {

    let btn = $('.dl-button'),
        label = btn.find('.label'),
        counter = label.find('.counter');

    setLabel(label, label.find('.state'), label.find('.default'), function() {
        counter.removeClass('hide');
        btn.removeClass('done');
    });

    return false;

});

function setLabel(div, oldD, newD, callback) {
    oldD.addClass('hide');
    div.animate({
        width: newD.outerWidth()
    }, 200, function() {
        oldD.removeClass('show hide');
        newD.addClass('show');
        div.removeAttr('style');
        if(typeof callback === 'function') {
            callback();
        }
    });
}
        
</script>




