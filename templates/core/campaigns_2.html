
{% from "macros/dashboard_macros.html" import goals, tactics, insights, ads_performance, ad_metrics, test_performance %}
{% from "macros/home_macros.html" import locked %}



{% set current_plan = page.data['core']['core'][0]['current_plan'] %}
{% set ab_plan = page.data['core']['core'][0]['ab_binary'] %}
{% set almost_free = page.data['core']['core'][0]['almost_free_binary'] %}
{% set ad_plan = page.data['core']['core'][0]['ad_binary'] %}
{% set ad_premium = page.data['core']['core'][0][''] %}
{% set company_name = page.data['core']['company_name'] %}

{% set base = page.data['core']['core'][0] %}

{% if not base.get('current_plan') %}
  <ad-spend
      company_name="{{page.data['core']['core'][0]['company_name']}}"
      customer_id="{{page.data['core']['core'][0]['id']}}"
      type="{{page.data['spend_rec']['spend_rec'][0]['model']}}"
      stage="{{base.get('stage')}}"
      revenue="{{base.get('revenue')}}"
      brand_strength="{{base.get('brand_strength') if base.get('brand_strength') else 'medium' }}"
      growth_needs="{{base.get('growth_needs') if base.get('growth_needs') else 'medium' }}"
      competitiveness="{{base.get('competitiveness') if base.get('competitiveness') else 'medium' }}"
      selling_to="{{base.get('selling_to')}}"
      biz_model="{{base.get('biz_model')}}"
      active_plan="{{base.get('current_plan')}}"
      demo="{{demo}}"
      online_perc="{{base.get('online_perc')}}"
      spend_rate="{{ base.get('spend_rate') }}">
  </ad-spend>



  <div class="wistia_container row">
    <div class='col-lg-2 col-md-2 col-sm-12 col-12'></div>
    <div class="col-lg-8 col-md-8 col-sm-12 col-12">
      <h1>Market(r) in 2:45</h1>
      <script src="https://fast.wistia.com/embed/medias/z3ijjllb9g.jsonp" async></script><script src="https://fast.wistia.com/assets/external/E-v1.js" async></script><div class="wistia_responsive_padding" style="padding:56.25% 0 0 0;position:relative;"><div class="wistia_responsive_wrapper" style="height:100%;left:0;position:absolute;top:0;width:100%;"><div class="wistia_embed wistia_async_z3ijjllb9g videoFoam=true" style="height:100%;position:relative;width:100%"><div class="wistia_swatch" style="height:100%;left:0;opacity:0;overflow:hidden;position:absolute;top:0;transition:opacity 200ms;width:100%;"><img src="https://fast.wistia.com/embed/medias/z3ijjllb9g/swatch" style="filter:blur(5px);height:100%;object-fit:contain;width:100%;" alt="" aria-hidden="true" onload="this.parentNode.style.opacity=1;" /></div></div></div></div>
    </div>
    <div class='col-lg-2 col-md-2 col-sm-12 col-12'></div>
  </div>



  <div class="next_steps">        
    <div class="inner">
        <h1 style="margin:0;padding:0;">You're 95% there.
            <span>Just 2 more clicks to get your superpowers.</span>
        </h1>
        <a id="destination_url" style="box-shadow:none !important;" href="/pricing?quantity=3" class="btn btn-primary">I want to see what's next</a>
    </div>
  </div>

{% endif %}



{% if page.data['core']['core'][0]['current_plan'] %}

  <div style="display:none;" id="date_popup_back">
    <div id="date_popup">
      <section id="date-header">
        <h1 style="margin:0;padding-top:0;" class="widget__title center_it">Select date range</h1>
        <div id="compare__container">
          <p class="small_txt">Compare date ranges?</p>
          <section class="switches" data-theme="blue">
            <div class="switch switch--5">
              <label class="switch__label">
                <input type="checkbox" class="switch__input">
                <span class="switch__design"></span>
              </label>
            </div>
          </section>
        </div>
      </section>
    
      <div class="ranger_wrappers" id="first_date_range"></div>
      <p id="date_range_helper" style="display:none;" class="center_it small_txt">Select the date range you want to compare</p>
      <div class="ranger_wrappers" id="compare_date_range"></div>
      <button style="display:none;" id="apply_date" class="btn btn-secondary">ok</button>
      <button style="display:none;" id="cancel_date" class="btn btn-neutral">cancel</button>

      <style>
        div#compare__container {
          width: 100%;
          margin: 0 auto;
          justify-content: center;
          display: flex;
        }
        div#compare__container p {
          margin-bottom: 0;
          margin-right: 2em;
        }
        section#date-header {
          display: inline-flex;
          justify-content: center;
          flex-direction: column;
          width: 100%;
        }
        .day.in-range { background-color: #62cde0 !important; }
        #date_popup { display:block; }
        #date_popup .btn {
          display: flex;
          position: absolute;
          bottom: 5%;
        }
        #date_popup .btn-secondary { right: 5%; }
        #date_popup .btn-neutral { right: 15%; }
        .ranger_wrappers .wrapper {
          display: flex;
          flex-direction: column;
          width: 50%;
          height: 50%;
          margin: 0 auto;
        }
      </style>
    </div>
  </div>
  <div class="row">
      <div class="col-lg-12 col-md-12 col-sm-12">
          
          {% if not page.data['core']['core'][0]['data_synced'] %}
              {{ section(
                  link=None,
                  title="",
                  body=todo(page, admin=False),
                  hash=None,
                  admin=page.admin
              ) }}
          {% else %}
          <div class="row row_cancel">
            <div class="col-lg-4 col-md-12 col-sm-12 col-12">
                <div class="">
                    <h1 class="widget__title" style="margin-bottom:0;text-align:left;padding-bottom:0;text-decoration:underline;">Recommendations</h1>
                    <customer-recommendations
                    demo="false"
                    customer_id="{{page.data['core']['core'][0]['id']}}'"
                    recs_json="{{page.data['recommendations']['recommendations']}}"
                    fetch="false"
                    analytics="{{page.data['core']['core'][0]['analytics']}}"
                    >
                  </customer-recommendations>
                </div>
            </div>
            <div class="col-lg-8 col-md-12 col-sm-12 col-12">  
                  <div id="performance_loader"></div>
                  <script type="module">
                      import {loading_shell} from '/static/src/components/UI_elements.js'
                      document.querySelector("#performance_loader").innerHTML = loading_shell()
                  </script>
                  <h1 class="widget__title" style="margin-bottom:.6em;text-align:left;padding-bottom:0;text-decoration:underline;">Marketing mix</h1>
                  
                  <portfolio-performance
                    first_sync="{{first_sync}}"
                    google_id="{{page.data['core']['core'][0]['google_id']}}"
                    facebook_id="{{page.data['core']['core'][0]['facebook_id']}}"
                    company-name="{{page.data['core']['core'][0]['company_name']}}"
                    customer-id="{{page.data['core']['core'][0]['id']}}"
                    spend_rate="{{page.data['core']['core'][0]['spend_rate']}}"
                    funds_remaining="{{page.data['core']['core'][0]['funds_remaining']}}"
                    ltv="{{page.data['core']['core'][0]['ltv']}}"
                    demo="{{demo}}"
                    insights="{{page.data['insights']['insights']}}"
                    recommendations="{{page.data['recommendations']['recommendations']}}"
                    analytics="{{ page.data['core']['core'][0]['analytics'] }}">
                  </portfolio-performance>
            </div>
          </div>

          {% endif %}


      </div>
  </div>
{% endif %}

