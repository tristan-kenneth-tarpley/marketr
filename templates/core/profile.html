{% set company_name = page.data['core']['core'][0]['company_name'] %}
{% set core = page.data['core']['core'][0] %}
{% set products = page.data['products']['products'] %}



{% macro google(headline=None, website=None, description=None) %}

	<div class="google_ad_preview_container">
		<h5 style="font-size: 110%;">{{ headline }}</h5>
		<p class="website"><span>Ad</span> {{ website }}</p>
		<p>{{ description }}</p>
	</div>

{% endmacro %}


{% macro one() %}
	<div class="row">
		<div class="col-lg-7 col-sm-12">
			<p><strong>Industry: {{core['industry']|safe}}</strong></p>
			<div class="col-lg-10 col-sm-12">
				<p>Stage: {{ core['stage'] }}</p>
				<p>Based in: {{ core['city'] }}, {{ core['state'] }}</p>
			</div>
		</div>
		<div class="col-lg-5 col-sm-12">
			<p><strong>Profile Owner:</strong></p>
			<p>{{ core['first_name'] }} {{ core['last_name'] }}</p>
			<p>{{ core['email'] }}</p>
		</div>
	</div>
{% endmacro %}

{% macro two() %}

	<p>{{core['company_name']}} is a {{ core['selling_to'] }} company in the {{ core['biz_model']}} space with their primary sources of revenue coming from the following channels: </p><br><br>

	<div class="row percentages">
		<div class="card col-lg-5 center_it">
			<div class="">
				<br>
				<h6 class="title">Storefront</h6>
				<p>(physical store, kiosk, truck, etc.)</p>
			</div>
			<p class="meter">
				{{ core['storefront_perc'] if core['storefront_perc'] != "" else "0" }}%
				<span class="perc_width"></span>
			</p>
		</div>
		<div class="card col-lg-5 center_it">
			<div class="">
				<br>
				<h6 class="title">Direct</h6>
				<p>(phone, mailers, email, etc.)</p>
			</div>
			<p class="meter">
				{{ core['direct_perc'] if core['direct_perc'] != "" else "0" }}%
				<span class="perc_width"></span>
			</p>
		</div>
		<div class="card col-lg-5 center_it">
			<div class="">
				<br>
				<h6 class="title">Online</h6>
				<p>(eCommerce, Saas, blog, online ads, blog, etc)</p>
			</div>
			<p class="meter">
				{{ core['online_perc'] if core['online_perc'] != "" else "0" }}%
				<span class="perc_width"></span>
			</p>
		</div>
		<div class="card col-lg-5 center_it">
			<div class="">
				<br>
				<h6 class="title">Tradeshows</h6>
				<p></p>
			</div>
			<p class="meter">
				{{ core['tradeshows_perc'] if core['tradeshows_perc'] != "" else "0" }}%
				<span class="perc_width"></span>
			</p>
		</div>
		<div class="card col-lg-5 center_it">
			<div class="">
				<br>
				<h6 class="title">Other</h6>
				<p></p>
				<br><br>
			</div>
			<p class="meter">
				{{ core['other_perc'] if core['other_perc'] != "" else "0" }}%
				<span class="perc_width"></span>
			</p>
		</div>
	</div>
	{% if core['rev_channel_freeform'] %}
		<p>Additional notes:</p>
		<p class="truncate inset">{{ core['rev_channel_freeform'] | clean_chars }}</p>
	{% endif %}
{% endmacro %}



{% macro competitors() %}

	{% macro comp_metrics(pos=1) %}
		{% set base = core['competitor_intro_1'] if pos == 1 else core['competitor_intro_2'] %}
		<div class="row comp_metrics">
			<div style="text-align:center;" class="col-lg-3 col-sm-12">
				<div class="comp_box comp_box-metrics">
					<p>Adwords Budget<br>
					<strong>${{ base['budget'] | currency }}/month</strong></p>
				</div>
				<div class="comp_box comp_box-metrics">
					<p><strong>{{ base['clicks'] | add_commas }}</strong><br>clicks in past 30 days</p>
				</div>
			</div>
			<div class="col-lg-1"></div>
			<div class="col-lg-8 col-sm-12 comp_box">
				<h5>Recent Ads</h5>
				{% if base['ads'] %}
					{{ google(
						headline=base['ads'][0]['title'],
						website=base['ads'][0]['url'],
						description=base['ads'][0]['body']
					) }}
					{{ google(
						headline=base['ads'][1]['title'],
						website=base['ads'][1]['url'],
						description=base['ads'][1]['body']
					) }}
				{% endif %}
			</div>
		</div>
	{% endmacro %}

	{% macro comp_header(pos=1) %}
		<div class="row">
			<div class="col-lg-4 col-sm-12">
				<h5>{{ core['comp_1_name'] if pos == 1 else core['comp_2_name'] }}</h5>
				<a href="https://{{ core['comp_1_website'] if pos == 1 else core['comp_2_website'] }}" target="__blank">{{core['comp_1_website'] if pos == 1 else core['comp_2_website']}}</a>
			</div>
			<div class="col-lg-2 col-sm-12">
				<p class="comp-badge">{{ core['comp_1_type'] if pos ==1 else core['comp_2_type'] }}</p>
				<p>Competitor type</p>
			</div>
		</div>
	{% endmacro %}

	{% if core['comp_1_name'] %}
		{{ comp_header() }}
		{{ comp_metrics() }}
		<div class="separator"></div>
		{{ comp_header(pos=2) }}
		{{ comp_metrics(pos=2) }}
	{% else %}
		<div class="row">
			<div class="col-lg-5 col-sm-12">
				<img src="/static/assets/img/competitors.jpg">
			</div>
			<div class="col-lg-1"></div>
			<div class="col-lg-6">
				<h5>Hey, what's your competition doing over there?..</h5>
				<p>Give us some info on your competitors and we'll pull some strings and collect valuable intelligence on things like:</p>
				<ul>
					<li>Estimated monthly spend</li>
					<li>Monthly clicks</li>
					<li>Recent Ads</li>
				</ul>
				{% if not admin %}<a href="{{url_for('competitors')}}" class="btn btn-secondary">Complete now</a>{% endif %}
			</div>
		</div>
	{% endif %}

{% endmacro %}

{% macro five() %}

{% if page.data['audiences']['audiences'] and page.data['audiences']['audiences'][0]['persona_name'] %}
	{% for audience in page.data['audiences']['audiences'] %}
		{% set state = audience %}
		{% if state['persona_name'] %}	
			<h5>Audience name: {{ state['persona_name']}}</h5>
			<table class="table table-responsive profile_table">
				<thead style="text-align:center;">
					<th>Demographic</th>
					<th>Personality</th>
					<th>Purchasing Habits</th>
				</thead>
				<tbody>
					<tr>
						<td>	
							<ul>
								<li> Targets 
									{% if state['gender'] == 'All' %}
										{{state['gender'] | lower}} genders
									{% else %}
										{{state['gender']}}
									{% endif %}
								</li>

								<li>Target ages:
									{% set ages = [
										state['age_group_1'],
										state['age_group_2'],
										state['age_group_3'],
										state['age_group_4'],
										state['age_group_5'],
										state['age_group_6'],
										state['age_group_7'],
										state['age_group_8']
									]%}
									<ul>
										{{ multi_val_iterator(ages) }}
									</ul>
								</li>
								<li>{{state['location'] if state['location'] | length }}</li>
							</ul>
						</td>
						<td>
							<ul>
								{% if state['formality']%}
									<li>{{state['formality']}}</li>
								{% endif %}
								{% if state['tech_savvy']%}
									<li>{{state['tech_savvy']}}</li>
								{% endif %}
								{% if state['detail-oriented']%}
									<li>{{state['detail-oriented']}}</li>
								{% endif %}
							</ul>
						</td>
						<td>
							<ul>
								{% if state['buying_for'] %}
									<li>They buy {{state['buying_for'] | lower }}</li>
								{% endif %}
								{% if state['decision_making'] %}
									<li>They are {{"the" if state['decision_making'] == 'Ultimate decision maker' }} {{state['decision_making'] | lower }}</li>
								{% endif %}
								{% if state['motive'] %}
									<li>They buy to {{state['motive'] | lower }}</li>
								{% endif %}
								{% if state['why'] %}
									<li>They buy because {{state['why'] | lower }}</li>
								{% endif %}
								<li>How they feel before buying:
									{% set before = [
										state['before_1'],
										state['before_2'],
										state['before_3'],
										state['before_4'],
										state['before_5'],
										state['before_6'],
										state['before_7'],
										state['before_8'],
										state['before_9'],
										state['before_10'],
									]%}
									<ul>
										{{ multi_val_iterator(before) }}
									</ul>
								</li>
								<li>How they feel after buying:
									{% set after = [
										state['after_1'],
										state['after_2'],
										state['after_3'],
										state['after_4'],
										state['after_5'],
										state['after_6'],
										state['after_7'],
										state['after_8'],
										state['after_9'],
										state['after_10']	
									]%}
									<ul>
										{{ multi_val_iterator(after) }}
									</ul>
								</li>
							</ul>
						</td>
					</tr>
				</tbody>
			</table>
		{% endif %}
	{% endfor %}
{% else %}
<div class="row">
	<div class="col-lg-6 col-sm-12"><br><br><br>
		<h5>Who are we without our customers?</h5>
		<p>Complete your customer persona section and Market(r) will be able to use artificial intelligence to create ads that connect with your target audience.</p>
		{% if not admin %}<a href="{{url_for('audience', splash=True)}}" class="btn btn-secondary">Complete now</a>{% endif %}
	</div>
	<div class="col-lg-5 col-sm-12"><img class="empty_img" src="/static/assets/img/audience.jpg"></div>
</div>
{% endif %}

{% endmacro %}

{% macro six() %}
	{% if core['quantity'] %}
		<p>{{ company_name }} offers {{ core['quantity'] }} products / services.</p><br><br>
		{% if core['link'] %}
			<a target="__blank" href="https://{{ core['link'] }}">Visit website</a>
			<br>
			<br>
		{% endif %}
		<h6>Offerings are segmented in the marketplace by:</h6>
		{% set segments = [
			core['segment_1'],
			core['segment_2'],
			core['segment_3'],
			core['segment_4'],
			core['segment_5'],
			core['segment_6'],
			core['segment_7'],
			core['segment_8'],
			core['segment_9'],
			core['segment_10'],
		]%}
		<ul>
			{{ multi_val_iterator(segments) }}
		</ul>

		<h6>And sourced via:</h6>
		{% set sources = [
			core['source_1'],
			core['source_2'],
			core['source_3'],
			core['source_4']
		]%}
		<ul>
			{{ multi_val_iterator(sources) }}
		</ul>
		{% if core['source_freeform'] %}
			<p>Additional sourcing info:</p>
			<p class="truncate">{{ core['source_freeform'] }}</p>
		{% endif %}
		<br>
		<div class="center_it">
			<h6>Offering Details</h6>
		</div>

		<table id="products" class="table-striped table table-borderless table-responsive">
			<thead>
				<th>Product Name</th>
				<th>Category</th>
				<th>COGS</th>
				<th>Sale Price</th>
				<th>Qty Sold Last 12 mos.</th>
				<th>Estimated Unique Buyers</th>
			</thead>
			<tbody>
			{% for index in page.data['products']['products'] %}
				{% set state = index %}
				{% if state %}
					<tr>
						<td><strong>{{ state['name'] if state['name'] else "" }}</strong></td>
						<td>{{ state['category'] if state['category'] else "" }}</td>
						<td>{{ state['cogs'] }}</td>
						<td>{{ state['sales_price'] }}</td>
						<td>{{ state['qty_sold'] if state['qty_sold'] | not_none else "" }}</td>
						<td>{{ state['est_unique_buyers'] if state['est_unique_buyers'] else "" }}</td>
					</tr>	
				{% endif %}
			{% endfor %}
			</tbody>
		</table>

		<div class="separator"></div>

	{% if not admin %}
		<div class="edit">
			<a href="{{url_for('product_2', home=True)}}" class="edit btn-primary btn">
				<i class="now-ui-icons design-2_ruler-pencil"></i>
			</a>
		</div>
	{% endif %}
		<br>
	<div class="center_it">
		<h6>Offering Detailed Analysis</h6>
	</div>

	<table class="table table-responsive table-borderless table-striped">
		<thead>
			<th> </th>
			{% for product in products %}
				{% set state = product %}
				<th>{{ state['name'] }}</th>
			{% endfor %}
		</thead>
		<tbody>
			<tr> 
				<th>Complexity</th>
				{{ product_val_iterator(products, 'price') }}
				{#{{ product_val_iterator(products, 'complexity') }}#}
			</tr>
			<tr>
				<th>Price</th>
				{{ product_val_iterator(products, 'price') }}
			</tr>
			<tr>
				<th>Frequency of Use</th>
				{{ product_val_iterator(products, 'frequency_of_use') }}
			</tr>
			<tr>
				<th>Frequency of Purchase</th>
				{{ product_val_iterator(products, 'frequency_of_purchase') }}
			</tr>
			<tr>
				
				<th>Value Prop</th>
				{% for product in products %}
					{% set value_props = [
						product['value_prop_1'],
						product['value_prop_2'],
						product['value_prop_3'],
						product['value_prop_4'],
						product['value_prop_5']
					]%}
					<td>
						{% for i in value_props %}
							{% if i %}
								<li>{{ i }},</li>
							{% endif %}
						{% endfor %}
					</td>
				{% endfor %}
			</tr>
			<tr>
				<th>Warranties or Guarantee</th>
				{{ product_val_iterator(products, 'warranties_or_guarantee') }}
			</tr>
			<tr>
				<th>Low or High # of skus</th>
				{{ product_val_iterator(products, 'num_skus') }}
			</tr>
			<tr>
				<th>Level of Customization</th>
				{{ product_val_iterator(products, 'level_of_customization') }}
			</tr>
		</tbody>
	</table>
	{% else %}
		<div class="row">
			<div class="col-lg-5 col-sm-12">
				<img src="/static/assets/img/product.jpg">
			</div>
			<div class="col-lg-1"></div><br><br><br>
			<div class="col-lg-6 col-sm-12">
				<h5>What value do you trade for customers' $?</h5>
				<p>By describing your product, its characteristics and positioning in the market, and customer value you'll unlock a wealth of new tactics that can help improve product-market-fit. </p>
				{% if not admin %}<a href="{{url_for('product', splash=True)}}" class="btn btn-secondary">Complete now</a>{% endif %}
			</div>
		</div>

	{% endif %}
{% endmacro %}

{% macro seven() %}
	{% set base = page.data['salescycle'] %}
	{% if base['awareness']
		or base['evaluation'] or base['conversion']
		or base['retention'] or base['referral'] %}

		<div class="row">
			<div class="col-1"></div>
			{% macro home_stage(stage_name) %}
			<div class="card home_stages col-2">
				<div class="container-fluid center_it">
					<h6>{{ stage_name | upper }}</h6>
				</div>
				<div class="container-fluid">
					<ul>
						{% if base[stage_name] %}
							{% for value in base[stage_name] %}
								<li>{{value}}</li>
							{% endfor %}
						{% endif %}
					</ul>
				</div>
			</div>&nbsp;
			{% endmacro %}

			{{ home_stage('awareness') }}
			{{ home_stage('evaluation') }}
			{{ home_stage('conversion') }}
			{{ home_stage('retention') }}
			{{ home_stage('referral') }}

		</div>
	{% else %}
		<div class="row">
			<div class="col-lg-6 col-sm-12"><br><br><br>
				<h5>How does your brand engage with customers throughout their buying experience?</h5>
				<p>Every business follows predictable sales cycles. Describe all the touchpoints in each state and Market(r) can recommend tactics to bridge any identified gaps.</p>
				{% if not admin %}<a href="{{url_for('salescycle', splash=True)}}" class="btn btn-secondary">Complete now</a>{% endif %}
			</div>
			<div class="col-lg-1"></div>
			<div class="col-lg-5 col-sm-12">
				<img src="/static/assets/img/salescycle.jpg">
			</div>
		</div>
	{% endif %}

{% endmacro %}

{% macro eight() %}
{% if page.data['platforms']['platforms'] %}
	<p>Average monthly spend across all platforms</p>
	<h5 class="title blue_header">{{ core['digital_spend']}}</h5>
	<div class="divider"></div>
	<div class="row">
		<div class="col-1"></div>
		<div class="col-3">
			<h6>Platform Name</h6>
		</div>
		<div class="col-3">
			<h6>Results</h6>
		</div>
		<div class="col-3">
			<h6>Still using?</h6>
		</div>
	</div>

	{% for index in page.data['platforms']['platforms'] %}
		{% set state = index %}
		<div class="row">
			<div class="col-1"></div>
			<div class="col-3">
				<h6>
					<span class="platform_img">
						{{ state['platform_name']}}
					</span>
				</h6>
			</div>
			<div class="col-3 results_img">
				<span>
					{{ state['results'] }}
				</span>
			</div>
			
			{% if state['currently_using'] == 'yes' %}
			<div class="col-2 center_it alert alert-success">
				ACTIVE
			</div>
			{% elif state['currently_using'] == 'no' %}
			<div class="col-2 center_it alert alert-secondary">
				INACTIVE
			</div>
			{% endif %}
		</div>
	{% endfor %}
	{% if core['history_freeform'] %}
		<p>Additional notes</p>
		<p class="inset truncate">{{ core['history_freeform'] | clean_chars }}</p>
	{% endif %}
{% else %}
	<div class="row">
		<div class="col-lg-5 col-sm-12">
			<img src="/static/assets/img/platforms.jpg">
		</div>
		<div class="col-lg-1"></div>
		<div class="col-lg-6 col-sm-12"><br><br><br>
			<h5>What have you already tried?</h5>
			<p>By detailing what you've done before and whether it was good or bad, our human account managers can provide better recommendations given that context.</p>
			{% if not admin %}<a href="{{url_for('history', splash=True)}}" class="btn btn-secondary">Complete now</a>{% endif %}
		</div>
	</div>
{% endif %}
{% endmacro %}



<div class="row">
	<div class="col-lg-8 col-sm-12">
		{{ section(
			link="begin",
			title=company_name,
			body=one(),
			hash="profile_information",
			admin=page.admin
		) }}
		{{ section(
			link="company",
			title="Company Info",
			body=two(),
			hash="company",
			admin=page.admin
		) }}		
	</div>
	<div class="col-lg-4 col-sm-12">
		<div class="card negative_card" style="padding: 8%;">
			{{ score() }}
		</div>
		{{ section(
			link="goals",
			title="Marketing Goal",
			body=goals(page),
			admin=page.admin
		) }}
	</div>
</div>

{{ section(
	link="competitors",
	title="Competitive Intelligence",
	body=competitors(),
	hash="competitors",
	admin=page.admin
) }}
{{ section(
	link="audience",
	title="Customer Personas",
	body=five(),
	hash="audience",
	admin=page.admin
) }}
{{ section(
	link="product",
	title="Product / Service Offering",
	body=six(),
	hash="products",
	admin=page.admin
) }}
{{ section(
	link="salescycle",
	title="Customer Journey",
	body=seven(),
	hash="salescycle",
	admin=page.admin
) }}
{{ section(
	link="platforms",
	title="Advertising Platforms",
	body=eight(),
	hash="platforms",
	admin=page.admin
) }}



